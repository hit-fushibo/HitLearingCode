# 哈工大计算机体系结构笔记

## 第一章-计算机体系结构的基本概念

### 1.1 计算机体系结构的概念

#### 1.1.1 存储程序计算机

![1700385634050](images/1700385634050.png)

四个组成部分：

* 运算器
* 存储器
* 输入输出设备
* 控制器

主要特点：

1. 以运算器为中心
2. 采用存储程序原理
3. 存储器是按地址访问的
4. 控制流由指令流产生
5. 指令由操作码和地址码组成
6. 数据以二进制编码表示

![1700385786309](images/1700385786309.png)

#### 1.1.2 计算机体系结构、组成和实现

计算机体系结构的概念由**阿姆道尔**于1964年首次明确：程序员所看到的计算机的属性，即概念性结构与功能特性。

对于通用寄存器型的机器，这些属性主要是指：

1. 数据表示
2. 寻址规则
3. 寄存器定义
4. 指令系统
5. 中断系统
6. 机器工作状态的定义和切换
7. 存储系统
8. 信息保护
9. I/O结构

计算机体系结构包括以下三个方面：

1. 计算机指令系统ISA
2. 计算机组成
3. 计算机硬件实现

#### 1.1.3 系列机和兼容

**系列机**：具有相同体系结构，但组成和实现不同的一系列不同型号的计算机系统

一种体系结构可以有多种组织、多种物理实现。

**软件兼容**：

* 系列机具有相同的体系结构，软件可以在系列计算机的各档机器上运行。
* 同一个软件可以不加修改地运行于体系结构相同的各档机器，而且它们所获得的结果一样，差别只在于有不同的运行时间。
* 兼容分为二进制级兼容、汇编级兼容、高级语言兼容、数据级兼容等等。

**兼容机**：不同厂家生产的具有相同体系结构的计算机

**兼容性**：

* 向上(下)兼容指的是按某档机器编制的程序，不加修改的就能运行于比它高(低)档的机器
* 向前(后)兼容指的是按某个时期投入市场的某种型号机器编制的程序，不加修改地就能运行于在它之前(后)投入市场的机器

![1700386991606](images/1700386991606.png)

**向下兼容和向后兼容**比向上兼容和向前兼容更重要

### 1.2 计算机体系结构的发展

#### 1.2.1 计算机的分代

一般认为到目前为止计算机已经发展了五代

![1700387141743](images/1700387141743.png)

计算机曾根据价格分为5个档次：巨型机、大型机、中型机、小型机、微型机。

![1700387281363](images/1700387281363.png)

技术和性能的“下移”。

新型体系结构的设计一方面是合理地增加计算机系统中硬件的功能比例、另一方面则是通过多种途径提高计算机体系结构中的并行性。

#### 1.2.2 软件的发展

最重要的发展趋势之一：程序和数据使用的存储器容量不断扩大。

1. 计算机语言和编译技术
2. 操作系统
3. 软件工具和中间件

#### 1.2.3 应用的发展

计算机技术和市场分为嵌入式计算机、掌上计算机、台式计算机、服务器、数据中心。

#### 1.2.4 相关核心产品技术的发展

1. 逻辑电路  摩尔定律
2. DRAM     单个DRAM模块的容量每年增加25-40%，增速逐年下降。
3. 闪存         近几年，每年约50-60%的速度增长，大约每两年翻一番，大量用于便携式设备。
4. 磁盘         从04年开始，大约每年增长40%，约每3年翻一番。SSD的成本的迅速下降。
5. 网络

#### 1.2.5 体系结构的发展

1. 分布的I/O处理能力
2. 保护的存储器空间
3. 存储器组织结构的发展
4. 并行处理技术
5. 指令集的发展

#### 1.2.6 并行处理技术的发展

并行性：计算机系统在同一时刻或者同一时间间隔内进行多种运算或操作。只要时间上相互重叠，就存在并行性。

* 同时性：两个及以上的事件在同一时刻发生
* 并发性：两个及以上的事件在同一时间间隔内发生

从执行程序的角度来看，并行性等级从低到高可分为：

* 指令内部并行： 单条指令中各微操作之间的并行。
* 指令级并行：并行执行两条或两条以上的指令。
* 线程级并行：并行执行两个或两个以上的线程。通常是以一个进程内派生的多个线程为调度单位。
* 任务级或过程级并行：并行执行两个或两个以上的过程或任务（程序段）， 以子程序或进程为调度单元。
* 作业或程序级并行：并行执行两个或两个以上的作业或程序。

从处理数据的角度来看， 并行性等级从低到高可分为：

* 字串位串：每次只对一个字的一位进行处理。最基本的串行处理方式，不存在并行性。
* 字串位并：同时对一个字的全部位进行处理，不同字之间是串行的。开始出现并行性。
* 字并位串：同时对许多字的同一位（称为位片）进行处理。具有较高的并行性。
* 全并行：同时对许多字的全部位或部分位进行处理。最高一级的并行。

计算机系统结构的Flynn分类法：按照指令和数据的关系，把计算机系统的结构分为4类：

* 单指令流单数据流SISD（Single Instruction stream Single Data stream）
* 单指令流多数据流SIMD（Single Instruction stream Multiple Data stream）
* 多指令流单数据流MISD（Multiple Instruction stream Single Data stream）
* 多指令流多数据流MIMD（Multiple Instruction stream Multiple Data stream）

提高并行性的途径;

1. 时间重叠
2. 资源重复
3. 资源共享

在单机系统并行性的发展中：

* 起主导作用的是时间重叠，基础是部件功能专用化
* 资源重复运用也十分普遍

![1700388531801](images/1700388531801.png)

* 资源共享的实质上是用单处理机模拟多处理机的功能

在多级系统并行性的发展中，遵循时间重叠、资源重复、资源共享原理，发展为3种不同的多处理机：同构型多处理机、异构型多处理机、分布式系统。

耦合度：反映多机系统中各机器之间物理连接的紧密程度和交互作用能力的强弱。

![1700388674438](images/1700388674438.png)

### 1.3 计算机系统设计和分析

#### 1.3.1 成本和价格

商品的标价由这样一些因素构成：原料成本、直接成本、毛利和折扣。

性能/成本设计：设计者需取得性能与成本之间的平衡。

对计算机系统成本产生影响的主要因素有：时间、产量、商品化等。最直接的影响是时间。

#### 1.3.2 基准测试程序

五类测试程序：

1. 真实程序
2. 修正的（或者脚本化）应用程序
3. 核心测试程序
4. 小测试程序
5. 合成测试程序

测试程序包

#### 1.3.1 量化设计基本原则

大概率事件优先原则：对于大概率事件(最常见的事件)，赋予它优先的处理权和资源使用权，以获得全局的最优结果

Amdahl定律：

$$
\text{系统加速比}=\frac{\text{总执行时间}_\text{加速前}}{\text{总执行时间}_\text{加速后}}=\frac{1}{(1-\text{可改进比例})+\frac{\text{可改进比例}}{部件加速比}}
$$

![1700389397512](images/1700389397512.png)

程序的局部性原理：程序总是趋向于使用最近使用过的数据和指令。

CPU的性能公式：

$$
T_{CPU}=CPI\times IC\times T_{CLK}
$$

进一步细化：一共有$n$条指令，第$i$条指令处理时间为$CPI_i$，出现次数为$IC_i$

$$
T_{CPU}=\sum_i{IC_i\times CPI_i\times T_{CLK}}\\CPI=\sum_i{\frac{IC_i}{IC}\times CPI_i}
$$

## 第二章 指令系统
